import subprocess
import os
from shutil import which
import platform

from web3_exploit_framework.core.exceptions import Command_Not_Found, Create_Softlink_Error


operating_system = platform.system()

"""OS Command Execution"""
def execute_one_command_under_specific_directory(command_list, path):
    try:
        prePWD = os.getcwd()
        os.chdir(path)
        execute_one_command(command_list)
        os.chdir(prePWD)
    except Exception as exception:
        raise exception
        
def execute_one_command(command_list):
    try:
        subprocess.run(command_list)
    except Exception as exception:
        raise exception
    
def execute_command_by_os_system(command):
    try:
        os.system(command)
    except Exception as exception:
        raise exception    

def execute_softlink_creation(src, dst):
    try:
        if operating_system ==  'Windows':
            command = ['mklink', '/D', src, dst]
        else:
            command = ['ln', '-s', src, dst]
        execute_one_command_under_specific_directory(command, os.path.dirname(dst))
    except Exception as e:
        raise Create_Softlink_Error

def is_command(command):
    return which(command) is not None
