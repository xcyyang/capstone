import argparse

import cmd2
from cmd2 import (
    CommandSet,
    with_argparser,
    with_category,
    with_default_category,
)

from web3_exploit_framework.core.development_framework_manage import (
    DevFrameworkManager,
)
from web3_exploit_framework.core.platform_dirs import (
    get_default_exploits_folder,
    get_default_interfaces_folder,
    get_default_tokens_folder,
    get_original_exploits_path,
    get_original_interfaces_path,
    get_original_tokens_path,
)
from web3_exploit_framework.core.utils.file import copy_folder


@with_default_category("Initialization")
class LoadableInitializationCommandSet(CommandSet):
    def __init__(self):
        super().__init__()
        self.development_framework_manager = DevFrameworkManager()

    """
    Init Command:
    This command is used to initialize the framework
    """
    init_parser = cmd2.Cmd2ArgumentParser()
    # init_parser.add_argument("name", nargs="?", help="The development framework to be initalized")

    @with_argparser(init_parser)  # type: ignore
    def do_init(self, opts: cmd2.Statement):
        """Initialize the Interfaces Database"""
        copy_folder(
            get_original_interfaces_path(), get_default_interfaces_folder()
        )
        """Initialize the Token Database"""
        copy_folder(get_original_tokens_path(), get_default_tokens_folder())
        """Initialize the Exploits Database"""
        copy_folder(
            get_original_exploits_path(), get_default_exploits_folder()
        )
        """Initialize the development framework"""
        self.development_framework_manager.initialize_framework("hardhat")
        self.development_framework_manager.initialize_framework("foundry")
